---
title: 单例模式 - 懒汉式
date: 2017-09-24 21:18:32
categories:
 - 设计模式
tags:
 - Java
 - 单例模式
---

##### Java 单例模式

> 单例模式保证了 系统内存中该类只存在一个对象，节省了系统资源，对于一些需要频繁创建销毁的对象，使
用单例模式可以提高系统性能。如：工具类、常用到的大对象

##### 单例模式的几种写法

- 懒汉式（本篇文章介绍）

- 饿汉式

- 使用静态内部类实现单例模式

- 使用枚举来实现单例

- 双重校验锁

  

#### 懒汉式

> 如字面描述「懒汉式」就意味在很懒，对象只有在使用的时候才会创建

- 非线程安全

  ```java
  public class Singleton{
    // 创建一个本类的局部变量
    private static Singleton instance;
    // 私有化构造方法
    private Singleton(){}
    // 创建的实例的构造方法
    public static Singleton getInstance(){
      if(null == instance){
        instance = new Singleton();
      }
      return instance;
    }
  }
  ```
  
  为什么是线程不安全的（只发生在第一次创建创建对象的前提下）?

  > 多线程的情况下, 两个线程同步运行。一起走到 `if(null == instance)` 空值判断时, 因为先前并没有线程创建了 `instance` 。所以这个时候 `instance` 还是空值。多个线程都会对 `if(null == instance)` 非空判断通过。两个线程就会创建两个对象实例。
>
  > PS: 最后 `instance` 会以最后最后一个实例空间为准。如果 `Singleton` 对象中有一个属性 `private int i` 并且每次业务操作都会这个值。那么在多线程的情况下这个 `i` 值就有可能出现丢失。 
  
  
  
- 线程安全

  ```java
  public class Singleton{
    private static Singleton instance;
    private Singleton(){
      System.out.println("new object");
    }
    // 直接通过 synchronized 关键字即可保证线程安全（这只是最简单的方式）
    public synchronized static Singleton getInstance(){ 
      if(null == instance){
        instance = new Singleton();
      }
      return instance;
    }
  }
  ```

  <a href="https://www.cnblogs.com/sunnyDream/p/8011186.html" target="_Blank">参考</a>

---

[个人博客](isyundong.net)